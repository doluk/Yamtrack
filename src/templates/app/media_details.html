{% extends "base.html" %}
{% load static %}
{% load app_tags %}

{% block title %}
  {{ media.title }} - Yamtrack
{% endblock title %}

{% block content %}
  {# Top section #}
  <div class="flex flex-col md:flex-row gap-10 mb-8">
    <div class="w-full md:w-1/4 max-w-[250px] mx-auto md:mx-0">
      <img alt="{{ media.title }}"
           class="w-full rounded-lg shadow-lg bg-[#2a2f35] object-cover"
           src="{{ media.image }}">
    </div>

    {# Media details #}
    <div class="md:w-3/4">
      <h1 class="text-3xl font-bold mb-4">{{ media.title }}</h1>
      <p class="text-gray-300 mb-6 line-clamp-6">{{ media.synopsis|safe }}</p>
      <div class="flex flex-wrap gap-2 mb-6">
        {% for genre in media.genres %}
          <span class="px-3 py-1 bg-purple-600 text-white rounded-full text-sm">{{ genre }}</span>
        {% endfor %}
      </div>
      <div class="flex items-center space-x-4">
        <div>
        <button class="inline-flex items-center justify-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-300 cursor-pointer"
                hx-get={% modal_url 'track' media %}
                hx-vals='{"return_url": "{{ request.get_full_path|urlencode }}"}'
                hx-target="#{% modal_id 'track' media %}"
                hx-trigger="click">
          <svg xmlns="http://www.w3.org/2000/svg"
               width="24"
               height="24"
               viewBox="0 0 24 24"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round"
               class="w-4 h-4 mr-2">
            <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"></path>
          </svg>
          <span>Track</span>
        </button>
        <div id="{% modal_id 'track' media %}"></div>
        </div>

        <div>
        <button class="inline-flex items-center justify-center px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 transition duration-300 cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg"
               width="24"
               height="24"
               viewBox="0 0 24 24"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round"
               class="w-4 h-4 mr-2">
            <path d="M11 12H3"></path>
            <path d="M16 6H3"></path>
            <path d="M16 18H3"></path>
            <path d="M18 9v6"></path>
            <path d="M21 12h-6"></path>
          </svg>
          <span>Custom List</span>
        </button>
        </div>

        <div>
        <button class="inline-flex items-center justify-center px-4 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-700 transition duration-300 cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg"
               width="24"
               height="24"
               viewBox="0 0 24 24"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round"
               class="w-4 h-4 mr-2">
            <path d="M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5" />
            <path d="M16 2v4" />
            <path d="M8 2v4" />
            <path d="M3 10h5" />
            <path d="M17.5 17.5 16 16.3V14" />
            <circle cx="16" cy="16" r="6" />
          </svg>
          <span>Logs</span>
        </button>
        </div>
      </div>
    </div>
  </div>

  {# More details and related media #}
  <div class="flex flex-col md:flex-row gap-10">
    {# Details Column #}
    <div class="w-full md:w-1/4 max-w-[250px]">
      <h2 class="text-2xl font-bold mb-4">Details</h2>
      <div class="bg-[#2a2f35] p-4 rounded-lg">
        {% for key, value in media.details.items %}
          <div class="mb-4 last:mb-0">
            <h3 class="text-sm font-semibold text-gray-400">{{ key|no_underscore|upper }}</h3>
            {% if value|is_list %}
              {% for item in value %}<p class="text-gray-200">{{ item }}</p>{% endfor %}
            {% else %}
              <p class="text-gray-200">{{ value|default_if_none:"Unknown" }}</p>
            {% endif %}
          </div>
        {% empty %}
          <div class="text-gray-200">No details available</div>
        {% endfor %}
      </div>
    </div>

    {# Related Media #}
    <div class="w-full md:w-3/4">
      {% for name, related_items in media.related.items %}
        {% if related_items %}
          <h2 class="text-2xl font-bold mb-4">{{ name|no_underscore|title }}</h2>
          <div class="grid gap-4 {% if not forloop.last %}mb-8{% endif %}"
               style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr))">
            {% for media in related_items %}
              <div class="bg-[#2a2f35] rounded-lg overflow-hidden shadow-lg relative">
                <div class="relative">
                  <img alt="{{ media.title }}"
                       class="w-full h-48 object-cover"
                       src="{{ media.image }}">
                  {% if media.rating %}
                    <div class="absolute top-2 right-2 bg-black bg-opacity-75 px-2 py-1 rounded-md">
                      <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="24"
                             height="24"
                             viewBox="0 0 24 24"
                             fill="none"
                             stroke="currentColor"
                             stroke-width="2"
                             stroke-linecap="round"
                             stroke-linejoin="round"
                             class="w-4 h-4 text-yellow-400 mr-1 fill-current">
                          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        <span class="text-xs text-white">{{ media.rating }}</span>
                      </div>
                    </div>
                  {% endif %}
                </div>

                <div class="p-3">
                  <a href="{{ media|media_url }}"
                     class="text-sm font-semibold text-white hover:text-indigo-400 transition duration-300">
                    {% if media.media_type == "season" and media.season_title %}
                      {{ media.season_title }}
                    {% else %}
                      {{ media.title }}
                    {% endif %}
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endblock content %}

{% extends "base.html" %}
{% load static %}

{% block extra_head %}
  {{ form.media.css }}
{% endblock extra_head %}

{% block title %}
  Lists - Yamtrack
{% endblock title %}

{% block content %}
  <div x-data="{ showModal: false }">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
      <div>
        <h1 class="text-3xl font-bold mb-2">Lists</h1>
        <p class="text-gray-400">Organize and share your media lists</p>
      </div>
      <button @click="showModal = true"
              class="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg"
             width="24"
             height="24"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="2"
             stroke-linecap="round"
             stroke-linejoin="round"
             class="w-5 h-5 mr-2">
          <path d="M5 12h14"></path>
          <path d="M12 5v14"></path>
        </svg>
        New List
      </button>
    </div>
    {% include "lists/components/list_form.html" %}
  </div>
  <div class="relative mb-6">
    <input placeholder="Search lists..."
           class="w-full py-2 pl-10 pr-4 bg-[#2a2f35] rounded-md text-white border border-gray-600 focus:border-indigo-500 focus:ring focus:ring-indigo-200/50"
           type="text"
           value="">
    <svg xmlns="http://www.w3.org/2000/svg"
         width="24"
         height="24"
         viewBox="0 0 24 24"
         fill="none"
         stroke="currentColor"
         stroke-width="2"
         stroke-linecap="round"
         stroke-linejoin="round"
         class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.3-4.3"></path>
    </svg>
  </div>

  <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4">
    {% for custom_list in custom_lists %}
      <div class="bg-[#2a2f35] rounded-lg overflow-hidden hover:shadow-lg group"
           x-data="{ showModal: false }">
        <div class="relative h-48 flex items-center justify-center">
          <img alt="{{ custom_list.name }}"
               class="{% if custom_list.image != IMG_NONE %}w-full h-full object-cover{% else %}w-3/5 h-3/5{% endif %}"
               src="{{ custom_list.image }}">

          <div class="absolute inset-0 bg-black/40 transition-opacity group-hover:bg-black/50"></div>
          <a href="{% url 'list_detail' custom_list.id %}"
             class="absolute inset-0"></a>

          <button class="absolute top-2 right-2 p-2 bg-black/50 hover:bg-black/75 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-200 text-white hover:text-indigo-400 cursor-pointer"
                  @click="showModal = true"
                  title="Edit list">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="24"
                 height="24"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round"
                 class="w-4 h-4">
              <path d="M20 7h-9"></path>
              <path d="M14 17H5"></path>
              <circle cx="17" cy="17" r="3"></circle><circle cx="7" cy="7" r="3"></circle>
            </svg>
          </button>
          <div class="absolute bottom-4 left-4 flex flex-col items-start max-w-[calc(100%-2rem)]">
            <h3 class="text-xl font-semibold text-white mb-1 line-clamp-1 w-full">{{ custom_list.name }}</h3>
            <p class="text-sm text-gray-200 line-clamp-2 w-full">{{ custom_list.description }}</p>
          </div>
        </div>
        <div class="p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg"
                   width="24"
                   height="24"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2"
                   stroke-linecap="round"
                   stroke-linejoin="round"
                   class="w-4 h-4 text-gray-400 mr-2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              <div class="flex -space-x-2">
                <div class="w-6 h-6 rounded-full bg-[#4f46e5] flex items-center justify-center border-2 border-[#2a2f35] text-xs font-medium"
                     title="{{ custom_list.owner.username }}">{{ custom_list.owner.username.0|upper }}</div>
                {% for collaborator in custom_list.collaborators.all %}
                  <div class="w-6 h-6 rounded-full bg-[#4b5563] flex items-center justify-center border-2 border-[#2a2f35] text-xs font-medium"
                       title="{{ collaborator.username }}">{{ collaborator.username.0|upper }}</div>
                {% endfor %}
              </div>
            </div>
            <div class="flex items-center text-gray-400 text-sm">
              {% with item_count=custom_list.items.count %}<span>{{ item_count }} item{{ item_count|pluralize }}</span>{% endwith %}
            </div>
          </div>
        </div>

        {% include "lists/components/list_form.html" with form=custom_list.form %}
      </div>
    {% endfor %}
  </div>
{% endblock content %}

{% block js %}
  {{ form.media.js }}
{% endblock js %}
